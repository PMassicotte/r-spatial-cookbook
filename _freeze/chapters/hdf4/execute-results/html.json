{
  "hash": "f6eeba802972826b0bbb918ebc10cf7b",
  "result": {
    "engine": "knitr",
    "markdown": "# HDF4\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(terra)\nlibrary(ncdf4)\n```\n:::\n\n\n\n\n\n## NetCDF (Network Common Data Form)\n\nLayers in the file can be listed using the `nc_open()` function:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfile <- here::here(\"data\", \"avhrr-only-v2.20160503.nc\")\n\nf <- nc_open(file)\nf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nFile /media/LaCie16TB/work/projects/documentation/read_rs_product/data/avhrr-only-v2.20160503.nc (NC_FORMAT_CLASSIC):\n\n     4 variables (excluding dimension variables):\n        short sst[lon,lat,zlev,time]   \n            long_name: Daily sea surface temperature\n            units: degrees C\n            _FillValue: -999\n            add_offset: 0\n            scale_factor: 0.00999999977648258\n            valid_min: -300\n            valid_max: 4500\n        short anom[lon,lat,zlev,time]   \n            long_name: Daily sea surface temperature anomalies\n            units: degrees C\n            _FillValue: -999\n            add_offset: 0\n            scale_factor: 0.00999999977648258\n            valid_min: -1200\n            valid_max: 1200\n        short err[lon,lat,zlev,time]   \n            long_name: Estimated error standard deviation of analysed_sst\n            units: degrees C\n            _FillValue: -999\n            add_offset: 0\n            scale_factor: 0.00999999977648258\n            valid_min: 0\n            valid_max: 1000\n        short ice[lon,lat,zlev,time]   \n            long_name: Sea ice concentration\n            units: percentage\n            _FillValue: -999\n            add_offset: 0\n            scale_factor: 0.00999999977648258\n            valid_min: 0\n            valid_max: 100\n\n     4 dimensions:\n        time  Size:1 \n            long_name: Center time of the day\n            units: days since 1978-01-01 00:00:00\n        zlev  Size:1 \n            long_name: Sea surface height\n            units: meters\n            actual_range: 0, 0\n        lat  Size:720 \n            long_name: Latitude\n            units: degrees_north\n            grids: Uniform grid from -89.875 to 89.875 by 0.25\n        lon  Size:1440 \n            long_name: Longitude\n            units: degrees_east\n            grids: Uniform grid from 0.125 to 359.875 by 0.25\n\n    7 global attributes:\n        Conventions: CF-1.0\n        title: Daily-OI-V2, Final, Data (Ship, Buoy, AVHRR: NOAA19, METOP, NCEP-ice)\n        History: Version 2.0\n        creation_date: 2016-07-01 23:22\n        Description: Reynolds, et al.(2007) Daily High-resolution Blended Analyses. Available at ftp://eclipse.ncdc.noaa.gov/pub/OI-daily/daily-sst.pdf  Climatology is based on 1971-2000 OI.v2 SST, Satellite data: Navy  NOAA19 METOP AVHRR, Ice data: NCEP ice\n        Source: NOAA/National Climatic Data Center\n        Contact: Dick Reynolds, email: Richard.W.Reynolds@noaa.gov & Chunying Liu, email: Chunying.liu@noaa.gov\n```\n\n\n:::\n:::\n\n\n\n\n\nOpening a specific layer is done with the `ncvar_get()` function:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(f[[\"var\"]])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"sst\"  \"anom\" \"err\"  \"ice\" \n```\n\n\n:::\n\n```{.r .cell-code}\nsst <- ncvar_get(f, \"sst\")\n\ndim(sst)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1440  720\n```\n\n\n:::\n\n```{.r .cell-code}\nnc_close(f)\n```\n:::\n\n\n\n\n\nHere, we're extracting the sea surface temperature (SST) data and checking its dimensions. Always remember to close the NetCDF file after use.\n\n## Open NetCDF file using `rast()`\n\nThe `terra` package provides an alternative method to work with NetCDF files. This creates a `SpatRaster` object, which is more memory-efficient for large datasets. It looks like the raster is rotated.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nr <- rast(file, lyrs = 1L)\n\nr\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass       : SpatRaster \ndimensions  : 720, 1440, 1  (nrow, ncol, nlyr)\nresolution  : 0.25, 0.25  (x, y)\nextent      : 0, 360, -90, 90  (xmin, xmax, ymin, ymax)\ncoord. ref. : lon/lat WGS 84 (CRS84) (OGC:CRS84) \nsource      : avhrr-only-v2.20160503.nc:sst \nvarname     : sst (Daily sea surface temperature) \nname        : sst_zlev=0 \nunit        :  degrees C \ntime (days) : 2016-05-03 \n```\n\n\n:::\n\n```{.r .cell-code}\nplot(r)\n```\n\n::: {.cell-output-display}\n![](hdf4_files/figure-html/unnamed-chunk-4-1.png)\n:::\n:::\n\n\n\n\n\nWe can rotate it back with the `rotate()` function:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nr <- rotate(r)\n\nplot(r)\n```\n\n::: {.cell-output-display}\n![](hdf4_files/figure-html/unnamed-chunk-5-1.png)\n:::\n:::\n\n\n\n\n\nConverting to a data frame can be useful for certain types of analysis or visualization, but be cautious with large datasets as this can be memory-intensive.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- as.data.frame(r)\n\nhead(df)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| sst_zlev=0|\n|----------:|\n|       -1.7|\n|       -1.7|\n|       -1.7|\n|       -1.7|\n|       -1.7|\n|       -1.7|\n\n</div>\n:::\n:::\n\n\n\n\n\n## Compare the values (WIP)\n\nI am noticing that the values of `sst` and `df$`sst_zlev=0`` are not the same. I should investigate this further.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Validate if I have to transpose the `sst` matrix before comparing\nwaldo::compare(df$`sst_zlev=0`, as.vector(t(sst)), tolerance = 1e-3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     old               | new                 \n [1] -1.69999996200204 - NA  [1]             \n [2] -1.69999996200204 - NA  [2]             \n [3] -1.69999996200204 - NA  [3]             \n [4] -1.69999996200204 - NA  [4]             \n [5] -1.69999996200204 - NA  [5]             \n [6] -1.69999996200204 - NA  [6]             \n [7] -1.69999996200204 - NA  [7]             \n [8] -1.69999996200204 - NA  [8]             \n [9] -1.69999996200204 - NA  [9]             \n[10] -1.69999996200204 - NA  [10]            \n ... ...                 ... and 707 more ...\n\n      old               | new                                \n[716] -1.69999996200204 | -1.69999996200204 [718]            \n[717] -1.69999996200204 | -1.69999996200204 [719]            \n[718] -1.69999996200204 | -1.69999996200204 [720]            \n[719] -1.69999996200204 - NA                [721]            \n[720] -1.69999996200204 - NA                [722]            \n[721] -1.69999996200204 - NA                [723]            \n[722] -1.69999996200204 - NA                [724]            \n[723] -1.69999996200204 - NA                [725]            \n[724] -1.69999996200204 - NA                [726]            \n[725] -1.69999996200204 - NA                [727]            \n  ... ...                 ...               and 7187 more ...\n\n       old               | new                                  \n[7916] -1.69999996200204 | -1.69999996200204 [7918]             \n[7917] -1.69999996200204 | -1.69999996200204 [7919]             \n[7918] -1.69999996200204 | -1.69999996200204 [7920]             \n[7919] -1.69999996200204 - NA                [7921]             \n[7920] -1.69999996200204 - NA                [7922]             \n[7921] -1.69999996200204 - NA                [7923]             \n[7922] -1.68999996222556 - NA                [7924]             \n[7923] -1.68999996222556 - NA                [7925]             \n[7924] -1.68999996222556 - NA                [7926]             \n[7925] -1.68999996222556 - NA                [7927]             \n   ... ...                 ...               and 624996 more ...\n\n         old               | new                                \n[632839] -1.79999995976686 | -1.79999995976686 [632841]         \n[632840] -1.79999995976686 | -1.79999995976686 [632842]         \n[632841] -1.79999995976686 | -1.79999995976686 [632843]         \n[632842] -1.75999996066093 - -1.79999995976686 [632844]         \n[632843] -1.74999996088445 - -1.79999995976686 [632845]         \n[632844] -1.74999996088445 - -1.79999995976686 [632846]         \n[632845] -1.76999996043742 - -1.79999995976686 [632847]         \n[632846] -1.75999996066093 - -1.79999995976686 [632848]         \n[632847] -1.75999996066093 - -1.79999995976686 [632849]         \n[632848] -1.74999996088445 - -1.79999995976686 [632850]         \n     ... ...                 ...               and 1416 more ...\n\n         old               | new                             \n[634269] -1.79999995976686 | -1.79999995976686 [634271]      \n[634270] -1.79999995976686 | -1.79999995976686 [634272]      \n[634271] -1.79999995976686 | -1.79999995976686 [634273]      \n[634272] -1.79999995976686 - -1.78999995999038 [634274]      \n[634273] -1.79999995976686 - -1.7799999602139  [634275]      \n[634274] -1.79999995976686 - -1.78999995999038 [634276]      \n[634275] -1.79999995976686 - -1.78999995999038 [634277]      \n[634276] -1.79999995976686 - -1.78999995999038 [634278]      \n[634277] -1.79999995976686 | -1.79999995976686 [634279]      \n[634278] -1.79999995976686 | -1.79999995976686 [634280]      \n     ... ...                 ...               and 1 more ...\n\n         old               | new                                \n[634284] -1.79999995976686 | -1.79999995976686 [634286]         \n[634285] -1.79999995976686 | -1.79999995976686 [634287]         \n[634286] -1.79999995976686 | -1.79999995976686 [634288]         \n[634287] -1.7799999602139  - -1.79999995976686 [634289]         \n[634288] -1.7799999602139  - -1.79999995976686 [634290]         \n[634289] -1.75999996066093 - -1.79999995976686 [634291]         \n[634290] -1.70999996177852 - -1.79999995976686 [634292]         \n[634291] -1.65999996289611 - -1.79999995976686 [634293]         \n[634292] -1.6099999640137  - -1.79999995976686 [634294]         \n[634293] -1.57999996468425 - -1.79999995976686 [634295]         \n     ... ...                 ...               and 1410 more ...\n\n         old               | new                             \n[635709] -1.79999995976686 | -1.79999995976686 [635711]      \n[635710] -1.79999995976686 | -1.79999995976686 [635712]      \n[635711] -1.79999995976686 | -1.79999995976686 [635713]      \n[635712] -1.79999995976686 - -1.78999995999038 [635714]      \n[635713] -1.79999995976686 - -1.7799999602139  [635715]      \n[635714] -1.79999995976686 - -1.76999996043742 [635716]      \n[635715] -1.79999995976686 - -1.7799999602139  [635717]      \n[635716] -1.79999995976686 - -1.7799999602139  [635718]      \n[635717] -1.79999995976686 - -1.78999995999038 [635719]      \n[635718] -1.79999995976686 - -1.78999995999038 [635720]      \n     ... ...                 ...               and 3 more ...\n\n         old               | new                                \n[635725] -1.79999995976686 | -1.79999995976686 [635727]         \n[635726] -1.79999995976686 | -1.79999995976686 [635728]         \n[635727] -1.79999995976686 | -1.79999995976686 [635729]         \n[635728] -1.78999995999038 - -1.79999995976686 [635730]         \n[635729] -1.7799999602139  - -1.79999995976686 [635731]         \n[635730] -1.75999996066093 - -1.79999995976686 [635732]         \n[635731] -1.72999996133149 - -1.79999995976686 [635733]         \n[635732] -1.70999996177852 - -1.79999995976686 [635734]         \n[635733] -1.68999996222556 - -1.79999995976686 [635735]         \n[635734] -1.65999996289611 - -1.79999995976686 [635736]         \n     ... ...                 ...               and 1411 more ...\n\n         old               | new                             \n[637150] -1.79999995976686 | -1.79999995976686 [637151]      \n[637151] -1.79999995976686 | -1.79999995976686 [637152]      \n[637152] -1.79999995976686 | -1.79999995976686 [637153]      \n[637153] -1.79999995976686 - -1.78999995999038 [637154]      \n[637154] -1.79999995976686 - -1.7799999602139  [637155]      \n[637155] -1.79999995976686 - -1.76999996043742 [637156]      \n[637156] -1.79999995976686 - -1.76999996043742 [637157]      \n[637157] -1.79999995976686 - -1.76999996043742 [637158]      \n[637158] -1.79999995976686 - -1.76999996043742 [637159]      \n[637159] -1.79999995976686 - -1.7799999602139  [637160]      \n     ... ...                 ...               and 4 more ...\n\n         old               | new                                \n[637164] -1.79999995976686 | -1.79999995976686 [637166]         \n[637165] -1.79999995976686 | -1.79999995976686 [637167]         \n[637166] -1.79999995976686 | -1.79999995976686 [637168]         \n[637167] -1.78999995999038 - -1.79999995976686 [637169]         \n[637168] -1.78999995999038 - -1.79999995976686 [637170]         \n[637169] -1.78999995999038 - -1.79999995976686 [637171]         \n[637170] -1.78999995999038 - -1.79999995976686 [637172]         \n[637171] -1.78999995999038 - -1.79999995976686 [637173]         \n[637172] -1.78999995999038 - -1.79999995976686 [637174]         \n[637173] -1.7799999602139  - -1.79999995976686 [637175]         \n     ... ...                 ...               and 1416 more ...\n\nAnd 11 more differences ...\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check for missing values\nsum(is.na(sst))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 345650\n```\n\n\n:::\n\n```{.r .cell-code}\n# Looks like there are no missing values in the data frame\nsum(is.na(df$`sst_zlev=0`))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0\n```\n\n\n:::\n\n```{.r .cell-code}\nlength(sst)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1036800\n```\n\n\n:::\n\n```{.r .cell-code}\nlength(df$`sst_zlev=0`)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 691150\n```\n\n\n:::\n\n```{.r .cell-code}\n# Check data types\nstr(sst)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n num [1:1440, 1:720] NA NA NA NA NA NA NA NA NA NA ...\n```\n\n\n:::\n\n```{.r .cell-code}\nstr(df$`sst_zlev=0`)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n num [1:691150] -1.7 -1.7 -1.7 -1.7 -1.7 ...\n```\n\n\n:::\n\n```{.r .cell-code}\n# Compare a subset of data\nsst_subset <- sst[1:10, 1:10]\ndf_subset <- df$`sst_zlev=0`[1:100] # Adjust indexing as needed\n\n# Compare the subsets\nwaldo::compare(sst_subset, df_subset, tolerance = 1e-3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n`dim(old)` is an integer vector (10, 10)\n`dim(new)` is absent\n\n`old`:   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA and 90 more...\n`new`: -1.7 -1.7 -1.7 -1.7 -1.7 -1.7 -1.7 -1.7 -1.7 -1.7            ...\n```\n\n\n:::\n:::\n",
    "supporting": [
      "hdf4_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}