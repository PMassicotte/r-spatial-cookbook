[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "R Spatial Cookbook",
    "section": "",
    "text": "Preface\nThis book serves as a personal reference. It is intended to help me remember the techniques for manipulating spatial data in R.",
    "crumbs": [
      "Preface"
    ]
  },
  {
    "objectID": "modis.html",
    "href": "modis.html",
    "title": "1  MODIS",
    "section": "",
    "text": "1.1 L3BIN (Level-3 Binned Data) - HDF5\nIn these examples, we will use data from: Earth data. This website provides direct access to ocean color data products from various satellite missions, including MODIS. You can find Level-3 binned and mapped data here.\nLevel-3 binned (L3b) files are HDF5 files containing data that has been statistically processed and binned into spatial grids. The data is organized in layers, where each layer represents a different variable. These layers are stored in the /level-3_binned_data group within the HDF5 file. The BinList layer is particularly important, as it contains the bin information, such as the bin’s coordinates and the bin’s weights, which are crucial for proper interpretation of the data.\nIn R, these files can be read using the rhdf5 package from bioconductor. If you haven’t already, you’ll need to install the rhdf5 package. The following code shows how to install the package and then reads the chlor_a layer (chlorophyll-a concentration) from the file A2016160.L3b_DAY_CHL.nc:\nif (!require(\"BiocManager\", quietly = TRUE)) {\n  install.packages(\"BiocManager\")\n}\n\nBiocManager::install()\n\nBiocManager::install(\"rhdf5\")\nThe h5ls() function will list all the layers included in the HDF5 file. This is useful for exploring the file’s structure and identifying the available datasets.\nfile &lt;- fs::path(\"data\", \"AQUA_MODIS.20160608.L3b.DAY.CHL.nc\")\nh5ls(file)\n\nDatatype: binDataType\nDatatype: binIndexType\nDatatype: binListType\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ngroup\nname\notype\ndclass\ndim\n\n\n\n\n0\n/\nlevel-3_binned_data\nH5I_GROUP\n\n\n\n\n1\n/level-3_binned_data\nBinIndex\nH5I_DATASET\nCOMPOUND\n4320\n\n\n2\n/level-3_binned_data\nBinList\nH5I_DATASET\nCOMPOUND\n2417047\n\n\n3\n/level-3_binned_data\nbinDataDim\nH5I_DATASET\nFLOAT\n0\n\n\n4\n/level-3_binned_data\nbinIndexDim\nH5I_DATASET\nFLOAT\n0\n\n\n5\n/level-3_binned_data\nbinListDim\nH5I_DATASET\nFLOAT\n0\n\n\n6\n/level-3_binned_data\nchlor_a\nH5I_DATASET\nCOMPOUND\n2417047\n\n\n7\n/\nprocessing_control\nH5I_GROUP\n\n\n\n\n8\n/processing_control\ninput_parameters\nH5I_GROUP\nFinally, use h5read() to open a specific layer:\ndf &lt;- h5read(file, \"/level-3_binned_data/chlor_a\")\nhead(df)\n\n\n\n\n\nsum\nsum_squared\n\n\n\n\n0.1869691\n0.03495743\n\n\n0.2829849\n0.05712159\n\n\n0.4636284\n0.09679225\n\n\n0.6681932\n0.13557214\n\n\n0.5648066\n0.12085202\n\n\n0.4852219\n0.09646683\nThe resulting data frame df will contain the binned chlorophyll-a data. The columns in this data frame represent:\nTo apply the weights, read the BinList layer and divide the sum column by the weights column:\nbins &lt;- h5read(file, \"/level-3_binned_data/BinList\")\n\ndf[[\"sum\"]] &lt;- df[[\"sum\"]] / bins[[\"weights\"]]\n\nhead(df)\n\n\n\n\n\nsum\nsum_squared\n\n\n\n\n0.1869691\n0.03495743\n\n\n0.2001005\n0.05712159\n\n\n0.2073409\n0.09679225\n\n\n0.2014678\n0.13557214\n\n\n0.2134768\n0.12085202\n\n\n0.1980910\n0.09646683\nThe df[[\"sum\"]] column now contains the weighted average chlorophyll-a concentration for each bin. You can now perform further analysis or visualization with this data.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>MODIS</span>"
    ]
  },
  {
    "objectID": "modis.html#l3bin-level-3-binned-data---hdf5",
    "href": "modis.html#l3bin-level-3-binned-data---hdf5",
    "title": "1  MODIS",
    "section": "",
    "text": "sum: The sum of the chlorophyll-a values of all pixels within the bin.\nsum_squared: The sum of the squared chlorophyll-a values within the bin. This can be used to calculate the variance or standard deviation of the data within the bin.\n\n\n\n\n\n\n\nImportant: Applying Weights\n\n\n\nIt is crucial to understand that the observed values in the sum column need to be weighted to obtain the actual average chlorophyll-a concentration for each bin. The weights, representing the relative contribution of each pixel to the bin, are stored in the BinList layer.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>MODIS</span>"
    ]
  },
  {
    "objectID": "modis.html#l3map-level-3-mapped-data---netcdf",
    "href": "modis.html#l3map-level-3-mapped-data---netcdf",
    "title": "1  MODIS",
    "section": "1.2 L3MAP (Level-3 Mapped Data) - NetCDF",
    "text": "1.2 L3MAP (Level-3 Mapped Data) - NetCDF\nLevel-3 mapped (L3m) data represents geophysical variables projected onto a regular grid. These files are typically easier to visualize than L3b data because they are already in a gridded format.\n\nfile &lt;- fs::path(\"data\", \"AQUA_MODIS.20160608.L3m.DAY.CHL.chlor_a.4km.nc\")\n\nr &lt;- rast(file)\n\nr\n\nclass       : SpatRaster \ndimensions  : 4320, 8640, 1  (nrow, ncol, nlyr)\nresolution  : 0.04166667, 0.04166667  (x, y)\nextent      : -180, 180, -90.00001, 90  (xmin, xmax, ymin, ymax)\ncoord. ref. : +proj=longlat +datum=WGS84 +no_defs \nsource      : AQUA_MODIS.20160608.L3m.DAY.CHL.chlor_a.4km.nc:chlor_a \nvarname     : chlor_a (Chlorophyll Concentration, OCI Algorithm) \nname        : chlor_a \nunit        : mg m^-3 \n\n\nThis shows the raster’s metadata, such as the number of layers, the number of rows and columns, the resolution, and the extent.\n\nwm &lt;- ne_countries(scale = \"medium\", returnclass = \"sf\")\n\nplot(wm[[\"geometry\"]], col = \"lightgray\", lwd = 0.5)\nplot(r, add = TRUE, col = terrain.colors(10L))",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>MODIS</span>"
    ]
  },
  {
    "objectID": "modis.html#l3bin-level-3-binned-data---hdf4",
    "href": "modis.html#l3bin-level-3-binned-data---hdf4",
    "title": "1  MODIS",
    "section": "1.3 L3BIN (Level-3 Binned Data) - hdf4",
    "text": "1.3 L3BIN (Level-3 Binned Data) - hdf4\n\nfilename &lt;- fs::path(\"data\", \"MYD08_D3.A2003181.061.2018007232726.hdf\")\n\nsdss &lt;- describe(filename, sds = TRUE, meta = FALSE, parse = FALSE)\nhead(sdss)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nid\nname\nvar\ndesc\nnrow\nncol\nnlyr\n\n\n\n\n1\nHDF4_EOS:EOS_GRID:“data/MYD08_D3.A2003181.061.2018007232726.hdf”:mod08:Solar_Zenith_Mean\nSolar_Zenith_Mean\n[180x360] Solar_Zenith_Mean mod08 (16-bit integer)\n180\n360\n1\n\n\n2\nHDF4_EOS:EOS_GRID:“data/MYD08_D3.A2003181.061.2018007232726.hdf”:mod08:Solar_Zenith_Standard_Deviation\nSolar_Zenith_Standard_Deviation\n[180x360] Solar_Zenith_Standard_Deviation mod08 (16-bit integer)\n180\n360\n1\n\n\n3\nHDF4_EOS:EOS_GRID:“data/MYD08_D3.A2003181.061.2018007232726.hdf”:mod08:Solar_Zenith_Minimum\nSolar_Zenith_Minimum\n[180x360] Solar_Zenith_Minimum mod08 (16-bit integer)\n180\n360\n1\n\n\n4\nHDF4_EOS:EOS_GRID:“data/MYD08_D3.A2003181.061.2018007232726.hdf”:mod08:Solar_Zenith_Maximum\nSolar_Zenith_Maximum\n[180x360] Solar_Zenith_Maximum mod08 (16-bit integer)\n180\n360\n1\n\n\n5\nHDF4_EOS:EOS_GRID:“data/MYD08_D3.A2003181.061.2018007232726.hdf”:mod08:Solar_Zenith_Pixel_Counts\nSolar_Zenith_Pixel_Counts\n[180x360] Solar_Zenith_Pixel_Counts mod08 (16-bit integer)\n180\n360\n1\n\n\n6\nHDF4_EOS:EOS_GRID:“data/MYD08_D3.A2003181.061.2018007232726.hdf”:mod08:Solar_Azimuth_Mean\nSolar_Azimuth_Mean\n[180x360] Solar_Azimuth_Mean mod08 (16-bit integer)\n180\n360\n1\n\n\n\n\n\nr &lt;- rast(filename, 142L)\n\nplot(r)",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>MODIS</span>"
    ]
  },
  {
    "objectID": "hdf4.html",
    "href": "hdf4.html",
    "title": "2  HDF4",
    "section": "",
    "text": "2.1 NetCDF (Network Common Data Form)\nLayers in the file can be listed using the nc_open() function:\nfile &lt;- fs::path(\"data\", \"avhrr-only-v2.20160503.nc\")\n\nf &lt;- nc_open(file)\nf\n\nFile data/avhrr-only-v2.20160503.nc (NC_FORMAT_CLASSIC):\n\n     4 variables (excluding dimension variables):\n        short sst[lon,lat,zlev,time]   \n            long_name: Daily sea surface temperature\n            units: degrees C\n            _FillValue: -999\n            add_offset: 0\n            scale_factor: 0.00999999977648258\n            valid_min: -300\n            valid_max: 4500\n        short anom[lon,lat,zlev,time]   \n            long_name: Daily sea surface temperature anomalies\n            units: degrees C\n            _FillValue: -999\n            add_offset: 0\n            scale_factor: 0.00999999977648258\n            valid_min: -1200\n            valid_max: 1200\n        short err[lon,lat,zlev,time]   \n            long_name: Estimated error standard deviation of analysed_sst\n            units: degrees C\n            _FillValue: -999\n            add_offset: 0\n            scale_factor: 0.00999999977648258\n            valid_min: 0\n            valid_max: 1000\n        short ice[lon,lat,zlev,time]   \n            long_name: Sea ice concentration\n            units: percentage\n            _FillValue: -999\n            add_offset: 0\n            scale_factor: 0.00999999977648258\n            valid_min: 0\n            valid_max: 100\n\n     4 dimensions:\n        time  Size:1 \n            long_name: Center time of the day\n            units: days since 1978-01-01 00:00:00\n        zlev  Size:1 \n            long_name: Sea surface height\n            units: meters\n            actual_range: 0, 0\n        lat  Size:720 \n            long_name: Latitude\n            units: degrees_north\n            grids: Uniform grid from -89.875 to 89.875 by 0.25\n        lon  Size:1440 \n            long_name: Longitude\n            units: degrees_east\n            grids: Uniform grid from 0.125 to 359.875 by 0.25\n\n    7 global attributes:\n        Conventions: CF-1.0\n        title: Daily-OI-V2, Final, Data (Ship, Buoy, AVHRR: NOAA19, METOP, NCEP-ice)\n        History: Version 2.0\n        creation_date: 2016-07-01 23:22\n        Description: Reynolds, et al.(2007) Daily High-resolution Blended Analyses. Available at ftp://eclipse.ncdc.noaa.gov/pub/OI-daily/daily-sst.pdf  Climatology is based on 1971-2000 OI.v2 SST, Satellite data: Navy  NOAA19 METOP AVHRR, Ice data: NCEP ice\n        Source: NOAA/National Climatic Data Center\n        Contact: Dick Reynolds, email: Richard.W.Reynolds@noaa.gov & Chunying Liu, email: Chunying.liu@noaa.gov\nOpening a specific layer is done with the ncvar_get() function:\nnames(f[[\"var\"]])\n\n[1] \"sst\"  \"anom\" \"err\"  \"ice\" \n\nsst &lt;- ncvar_get(f, \"sst\")\n\ndim(sst)\n\n[1] 1440  720\n\nnc_close(f)\nHere, we’re extracting the sea surface temperature (SST) data and checking its dimensions. Always remember to close the NetCDF file after use.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>HDF4</span>"
    ]
  },
  {
    "objectID": "hdf4.html#open-netcdf-file-using-rast",
    "href": "hdf4.html#open-netcdf-file-using-rast",
    "title": "2  HDF4",
    "section": "2.2 Open NetCDF file using rast()",
    "text": "2.2 Open NetCDF file using rast()\nThe terra package provides an alternative method to work with NetCDF files. This creates a SpatRaster object, which is more memory-efficient for large datasets. It looks like the raster is rotated.\n\nr &lt;- rast(file, lyrs = 1L)\n\nr\n\nclass       : SpatRaster \ndimensions  : 720, 1440, 1  (nrow, ncol, nlyr)\nresolution  : 0.25, 0.25  (x, y)\nextent      : 0, 360, -90, 90  (xmin, xmax, ymin, ymax)\ncoord. ref. : lon/lat WGS 84 (CRS84) (OGC:CRS84) \nsource      : avhrr-only-v2.20160503.nc:sst \nvarname     : sst (Daily sea surface temperature) \nname        : sst_zlev=0 \nunit        :  degrees C \ntime (days) : 2016-05-03 \n\nplot(r)\n\n\n\n\n\n\n\n\nWe can rotate it back with the rotate() function:\n\nr &lt;- rotate(r)\n\nplot(r)\n\n\n\n\n\n\n\n\nConverting to a data frame can be useful for certain types of analysis or visualization, but be cautious with large datasets as this can be memory-intensive.\n\ndf &lt;- as.data.frame(r)\n\nhead(df)\n\n\n\n\n\nsst_zlev=0\n\n\n\n\n-1.7\n\n\n-1.7\n\n\n-1.7\n\n\n-1.7\n\n\n-1.7\n\n\n-1.7",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>HDF4</span>"
    ]
  },
  {
    "objectID": "hdf4.html#compare-the-values-wip",
    "href": "hdf4.html#compare-the-values-wip",
    "title": "2  HDF4",
    "section": "2.3 Compare the values (WIP)",
    "text": "2.3 Compare the values (WIP)\nI am noticing that the values of sst and df$sst_zlev=0`` are not the same. I should investigate this further.\n\n# Validate if I have to transpose the `sst` matrix before comparing\nwaldo::compare(df$`sst_zlev=0`, as.vector(t(sst)), tolerance = 1e-3)\n\n     old               | new                 \n [1] -1.69999996200204 - NA  [1]             \n [2] -1.69999996200204 - NA  [2]             \n [3] -1.69999996200204 - NA  [3]             \n [4] -1.69999996200204 - NA  [4]             \n [5] -1.69999996200204 - NA  [5]             \n [6] -1.69999996200204 - NA  [6]             \n [7] -1.69999996200204 - NA  [7]             \n [8] -1.69999996200204 - NA  [8]             \n [9] -1.69999996200204 - NA  [9]             \n[10] -1.69999996200204 - NA  [10]            \n ... ...                 ... and 707 more ...\n\n      old               | new                                \n[716] -1.69999996200204 | -1.69999996200204 [718]            \n[717] -1.69999996200204 | -1.69999996200204 [719]            \n[718] -1.69999996200204 | -1.69999996200204 [720]            \n[719] -1.69999996200204 - NA                [721]            \n[720] -1.69999996200204 - NA                [722]            \n[721] -1.69999996200204 - NA                [723]            \n[722] -1.69999996200204 - NA                [724]            \n[723] -1.69999996200204 - NA                [725]            \n[724] -1.69999996200204 - NA                [726]            \n[725] -1.69999996200204 - NA                [727]            \n  ... ...                 ...               and 7187 more ...\n\n       old               | new                                  \n[7916] -1.69999996200204 | -1.69999996200204 [7918]             \n[7917] -1.69999996200204 | -1.69999996200204 [7919]             \n[7918] -1.69999996200204 | -1.69999996200204 [7920]             \n[7919] -1.69999996200204 - NA                [7921]             \n[7920] -1.69999996200204 - NA                [7922]             \n[7921] -1.69999996200204 - NA                [7923]             \n[7922] -1.68999996222556 - NA                [7924]             \n[7923] -1.68999996222556 - NA                [7925]             \n[7924] -1.68999996222556 - NA                [7926]             \n[7925] -1.68999996222556 - NA                [7927]             \n   ... ...                 ...               and 624996 more ...\n\n         old               | new                                \n[632839] -1.79999995976686 | -1.79999995976686 [632841]         \n[632840] -1.79999995976686 | -1.79999995976686 [632842]         \n[632841] -1.79999995976686 | -1.79999995976686 [632843]         \n[632842] -1.75999996066093 - -1.79999995976686 [632844]         \n[632843] -1.74999996088445 - -1.79999995976686 [632845]         \n[632844] -1.74999996088445 - -1.79999995976686 [632846]         \n[632845] -1.76999996043742 - -1.79999995976686 [632847]         \n[632846] -1.75999996066093 - -1.79999995976686 [632848]         \n[632847] -1.75999996066093 - -1.79999995976686 [632849]         \n[632848] -1.74999996088445 - -1.79999995976686 [632850]         \n     ... ...                 ...               and 1416 more ...\n\n         old               | new                             \n[634269] -1.79999995976686 | -1.79999995976686 [634271]      \n[634270] -1.79999995976686 | -1.79999995976686 [634272]      \n[634271] -1.79999995976686 | -1.79999995976686 [634273]      \n[634272] -1.79999995976686 - -1.78999995999038 [634274]      \n[634273] -1.79999995976686 - -1.7799999602139  [634275]      \n[634274] -1.79999995976686 - -1.78999995999038 [634276]      \n[634275] -1.79999995976686 - -1.78999995999038 [634277]      \n[634276] -1.79999995976686 - -1.78999995999038 [634278]      \n[634277] -1.79999995976686 | -1.79999995976686 [634279]      \n[634278] -1.79999995976686 | -1.79999995976686 [634280]      \n     ... ...                 ...               and 1 more ...\n\n         old               | new                                \n[634284] -1.79999995976686 | -1.79999995976686 [634286]         \n[634285] -1.79999995976686 | -1.79999995976686 [634287]         \n[634286] -1.79999995976686 | -1.79999995976686 [634288]         \n[634287] -1.7799999602139  - -1.79999995976686 [634289]         \n[634288] -1.7799999602139  - -1.79999995976686 [634290]         \n[634289] -1.75999996066093 - -1.79999995976686 [634291]         \n[634290] -1.70999996177852 - -1.79999995976686 [634292]         \n[634291] -1.65999996289611 - -1.79999995976686 [634293]         \n[634292] -1.6099999640137  - -1.79999995976686 [634294]         \n[634293] -1.57999996468425 - -1.79999995976686 [634295]         \n     ... ...                 ...               and 1410 more ...\n\n         old               | new                             \n[635709] -1.79999995976686 | -1.79999995976686 [635711]      \n[635710] -1.79999995976686 | -1.79999995976686 [635712]      \n[635711] -1.79999995976686 | -1.79999995976686 [635713]      \n[635712] -1.79999995976686 - -1.78999995999038 [635714]      \n[635713] -1.79999995976686 - -1.7799999602139  [635715]      \n[635714] -1.79999995976686 - -1.76999996043742 [635716]      \n[635715] -1.79999995976686 - -1.7799999602139  [635717]      \n[635716] -1.79999995976686 - -1.7799999602139  [635718]      \n[635717] -1.79999995976686 - -1.78999995999038 [635719]      \n[635718] -1.79999995976686 - -1.78999995999038 [635720]      \n     ... ...                 ...               and 3 more ...\n\n         old               | new                                \n[635725] -1.79999995976686 | -1.79999995976686 [635727]         \n[635726] -1.79999995976686 | -1.79999995976686 [635728]         \n[635727] -1.79999995976686 | -1.79999995976686 [635729]         \n[635728] -1.78999995999038 - -1.79999995976686 [635730]         \n[635729] -1.7799999602139  - -1.79999995976686 [635731]         \n[635730] -1.75999996066093 - -1.79999995976686 [635732]         \n[635731] -1.72999996133149 - -1.79999995976686 [635733]         \n[635732] -1.70999996177852 - -1.79999995976686 [635734]         \n[635733] -1.68999996222556 - -1.79999995976686 [635735]         \n[635734] -1.65999996289611 - -1.79999995976686 [635736]         \n     ... ...                 ...               and 1411 more ...\n\n         old               | new                             \n[637150] -1.79999995976686 | -1.79999995976686 [637151]      \n[637151] -1.79999995976686 | -1.79999995976686 [637152]      \n[637152] -1.79999995976686 | -1.79999995976686 [637153]      \n[637153] -1.79999995976686 - -1.78999995999038 [637154]      \n[637154] -1.79999995976686 - -1.7799999602139  [637155]      \n[637155] -1.79999995976686 - -1.76999996043742 [637156]      \n[637156] -1.79999995976686 - -1.76999996043742 [637157]      \n[637157] -1.79999995976686 - -1.76999996043742 [637158]      \n[637158] -1.79999995976686 - -1.76999996043742 [637159]      \n[637159] -1.79999995976686 - -1.7799999602139  [637160]      \n     ... ...                 ...               and 4 more ...\n\n         old               | new                                \n[637164] -1.79999995976686 | -1.79999995976686 [637166]         \n[637165] -1.79999995976686 | -1.79999995976686 [637167]         \n[637166] -1.79999995976686 | -1.79999995976686 [637168]         \n[637167] -1.78999995999038 - -1.79999995976686 [637169]         \n[637168] -1.78999995999038 - -1.79999995976686 [637170]         \n[637169] -1.78999995999038 - -1.79999995976686 [637171]         \n[637170] -1.78999995999038 - -1.79999995976686 [637172]         \n[637171] -1.78999995999038 - -1.79999995976686 [637173]         \n[637172] -1.78999995999038 - -1.79999995976686 [637174]         \n[637173] -1.7799999602139  - -1.79999995976686 [637175]         \n     ... ...                 ...               and 1416 more ...\n\nAnd 11 more differences ...\n\n\n\n# Check for missing values\nsum(is.na(sst))\n\n[1] 345650\n\n# Looks like there are no missing values in the data frame\nsum(is.na(df$`sst_zlev=0`))\n\n[1] 0\n\nlength(sst)\n\n[1] 1036800\n\nlength(df$`sst_zlev=0`)\n\n[1] 691150\n\n# Check data types\nstr(sst)\n\n num [1:1440, 1:720] NA NA NA NA NA NA NA NA NA NA ...\n\nstr(df$`sst_zlev=0`)\n\n num [1:691150] -1.7 -1.7 -1.7 -1.7 -1.7 ...\n\n# Compare a subset of data\nsst_subset &lt;- sst[1:10, 1:10]\ndf_subset &lt;- df$`sst_zlev=0`[1:100] # Adjust indexing as needed\n\n# Compare the subsets\nwaldo::compare(sst_subset, df_subset, tolerance = 1e-3)\n\n`dim(old)` is an integer vector (10, 10)\n`dim(new)` is absent\n\n`old`:   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA and 90 more...\n`new`: -1.7 -1.7 -1.7 -1.7 -1.7 -1.7 -1.7 -1.7 -1.7 -1.7            ...",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>HDF4</span>"
    ]
  },
  {
    "objectID": "nsidc.html",
    "href": "nsidc.html",
    "title": "3  NSIDC binary data",
    "section": "",
    "text": "3.1 Binary data\nBinary data is a format where information is stored in a sequence of bytes, representing data in its most basic form without any text-based structure. This format is efficient for storage and quick to read programmatically, but it’s not human-readable without proper interpretation. In the case of scientific datasets like sea ice concentration, binary formats were often used to minimize file size and optimize data processing speed.\nBased on the documentation, the binary files can be read using the following code:\nsic &lt;- readBin(fs::path(\"data\", \"nsidc\", \"nt_20171002_f17_v1.1_n.bin\"),\n  what = \"integer\",\n  n = 304L * 448L,\n  size = 1L,\n  signed = FALSE\n)\n\n\nlat &lt;-\n  readBin(\n    fs::path(\"data\", \"nsidc\", \"psn25lats_v3.dat\"),\n    what = \"integer\",\n    n = 304L * 448L,\n    size = 4L,\n    signed = TRUE\n  )\n\nlon &lt;-\n  readBin(\n    fs::path(\"data\", \"nsidc\", \"psn25lons_v3.dat\"),\n    what = \"integer\",\n    n = 304L * 448L,\n    size = 4L,\n    signed = TRUE\n  )\nWe can construct a data frame from the latitude, longitude, and sea ice concentration data:\ndf &lt;- data.frame(lat = lat / 100000L, lon = lon / 100000L, sic = sic)\n\nhead(df)\n\n\n\n\n\nlat\nlon\nsic\n\n\n\n\n31.10267\n168.3204\n48\n\n\n31.19941\n168.1488\n48\n\n\n31.29580\n167.9764\n50\n\n\n31.39183\n167.8034\n53\n\n\n31.48750\n167.6297\n53\n\n\n31.58280\n167.4553\n0\n\n\n\n\n\nrange(df[[\"sic\"]], na.rm = TRUE)\n\n[1]   0 254\nAccording to the documentation:",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>NSIDC binary data</span>"
    ]
  },
  {
    "objectID": "nsidc.html#binary-data",
    "href": "nsidc.html#binary-data",
    "title": "3  NSIDC binary data",
    "section": "",
    "text": "Note\n\n\n\nVersion 1 of the NSIDC-0081 sea ice concentration dataset is available in binary format but is no longer active. The current version (Version 2) is in NetCDF format.\n\n\n\n\n\n\n\n\nThe sea ice concentration floating-point values (fractional coverage ranging from 0.0 to 1.0) are multiplied by a scaling factor of 250. To convert to the fractional range of 0.0 to 1.0, divide the scaled data in the file by 250.\n\n\n\n\n\n\n\n\nData Value\nDescription\n\n\n\n\n0 - 250\nSea ice concentration (fractional coverage scaled by 250)\n\n\n251\nCircular mask used in the Arctic to cover the irregularly-shaped data gap around the pole (caused by the orbit inclination and instrument swath)\n\n\n252\nUnused\n\n\n253\nCoast\n\n\n254\nLand\n\n\n255\nMissing data\n\n\n\n\n3.1.1 Turning the data into a raster\nWe can turn the data into a raster object using the terra package. The sea ice concentration values are stored in a 448x304 matrix, which we can convert to a raster object.\n\nsic_matrix &lt;- matrix(sic, nrow = 448L, ncol = 304L, byrow = TRUE)\n\nr &lt;- rast(sic_matrix)\n\nplot(r)\n\n\n\n\n\n\n\next(r) &lt;- c(-3850000L, 3750000L, -5350000L, 5850000L)\ncrs(r) &lt;- \"+proj=stere +lat_0=90 +lat_ts=70 +lon_0=-45 +k=1 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs\"\n\nplot(r)",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>NSIDC binary data</span>"
    ]
  },
  {
    "objectID": "he5.html",
    "href": "he5.html",
    "title": "4  Working with HE5 Files for Sea Ice Data",
    "section": "",
    "text": "This section demonstrates how to access and visualize sea ice concentration data stored in HE5 files, focusing on data from the AMSR-E/AMSR2 Unified L3 Daily 12.5 km dataset. We’ll use R along with the gdalraster, stars, terra, and sf packages.\n\n\n\n\n\n\nDisclaimer\n\n\n\nThe code below is largely based/copied on the work of mdsumner.\n\n\n\nlibrary(gdalraster)\nlibrary(stars)\nlibrary(terra)\n\n\nfile &lt;- fs::path(\n  \"data\",\n  \"AMSR_U2_L3_SeaIce12km_B04_20140314.he5\"\n)\n\nThe code leverages the NetCDF interface to access subdatasets within the HE5 file. This allows us to access the geolocation arrays, which is crucial for proper spatial referencing.\n\nsub &lt;- paste0(\"NetCDF:\", file, \":\")\nsds &lt;- gdal_subdatasets(sub)\n\nsf::gdal_utils(\"info\", unlist(sds)[[30L]])\n\nDriver: netCDF/Network Common Data Format\nFiles: data/AMSR_U2_L3_SeaIce12km_B04_20140314.he5\nSize is 608, 896\nMetadata:\n  /HDFEOS INFORMATION/NC_GLOBAL#HDFEOSVersion=HDFEOS_5.1.15\n  /HDFEOS/GRIDS/NpPolarGrid12km/Data Fields/SI_12km_NH_ICECON_DAY#comment=data value meaning: 0 -- Open Water, 110 -- missing/not calculated, 120 -- Land\n  /HDFEOS/GRIDS/NpPolarGrid12km/Data Fields/SI_12km_NH_ICECON_DAY#coordinates=lon lat\n  /HDFEOS/GRIDS/NpPolarGrid12km/Data Fields/SI_12km_NH_ICECON_DAY#long_name=Sea ice concentration daily average\n  /HDFEOS/GRIDS/NpPolarGrid12km/Data Fields/SI_12km_NH_ICECON_DAY#units=percent\n  NC_GLOBAL#Conventions=CF-1.6\n  NC_GLOBAL#history=This version of the Sea Ice processing code contains updates provided by the science team on September 16, 2019. For details on these updates, see the release notes provided in the DAP.\n  NC_GLOBAL#institution=NASA's AMSR Science Investigator-led Processing System (SIPS)\n  NC_GLOBAL#references=Please cite these data as: Markus, T., J. C. Comiso, and W. N. Meier. 2018. AMSR-E/AMSR2 Unified L3 Daily 12.5 km Brightness Temperatures, Sea Ice Concentration, Motion & Snow Depth Polar Grids, Version 1. [Indicate subset used]. Boulder, Colorado USA. NASA National Snow and Ice Data Center Distributed Active Archive Center. doi: https://doi.org/10.5067/RA1MIJOYPK3P.\n  NC_GLOBAL#source=satellite observation\n  NC_GLOBAL#title=AMSR-E/AMSR2 Unified L3 Daily 12.5 km Brightness Temperatures, Sea Ice Concentration, Motion & Snow Depth Polar Grids\nGeolocation:\n  GEOREFERENCING_CONVENTION=PIXEL_CENTER\n  LINE_OFFSET=0\n  LINE_STEP=1\n  PIXEL_OFFSET=0\n  PIXEL_STEP=1\n  SRS=GEOGCS[\"WGS 84\",DATUM[\"WGS_1984\",SPHEROID[\"WGS 84\",6378137,298.257223563,AUTHORITY[\"EPSG\",\"7030\"]],AUTHORITY[\"EPSG\",\"6326\"]],PRIMEM[\"Greenwich\",0,AUTHORITY[\"EPSG\",\"8901\"]],UNIT[\"degree\",0.0174532925199433,AUTHORITY[\"EPSG\",\"9122\"]],AXIS[\"Latitude\",NORTH],AXIS[\"Longitude\",EAST],AUTHORITY[\"EPSG\",\"4326\"]]\n  X_BAND=1\n  X_DATASET=NETCDF:\"data/AMSR_U2_L3_SeaIce12km_B04_20140314.he5\":/HDFEOS/GRIDS/NpPolarGrid12km/lon\n  Y_BAND=1\n  Y_DATASET=NETCDF:\"data/AMSR_U2_L3_SeaIce12km_B04_20140314.he5\":/HDFEOS/GRIDS/NpPolarGrid12km/lat\nCorner Coordinates:\nUpper Left  (    0.0,    0.0)\nLower Left  (    0.0,  896.0)\nUpper Right (  608.0,    0.0)\nLower Right (  608.0,  896.0)\nCenter      (  304.0,  448.0)\nBand 1 Block=608x1 Type=Int32, ColorInterp=Undefined\n  Unit Type: percent\n  Metadata:\n    comment=data value meaning: 0 -- Open Water, 110 -- missing/not calculated, 120 -- Land\n    coordinates=lon lat\n    long_name=Sea ice concentration daily average\n    NETCDF_VARNAME=SI_12km_NH_ICECON_DAY\n    units=percent\n\n\nThe data needs to be transformed to a standard coordinate reference system (CRS). EPSG:3411 (NSIDC Sea Ice Polar Stereographic North) is commonly used for Northern Hemisphere sea ice data. The gdal_utils() function warps the data to this CRS and saves it to a temporary VRT (Virtual Raster) file. VRT files are useful because they act as a pointer to the original data without duplicating it, and allow for on-the-fly transformations.\n\ndsn &lt;- \"/vsimem/temp.vrt\"\n\nsf::gdal_utils(\n  \"warp\",\n  unlist(sds)[[30L]],\n  dsn,\n  options = c(\"-t_srs\", \"EPSG:3411\", \"-overwrite\")\n)\n\nprint(1L)\n\n[1] 1\n\n\nThe rast() function from the terra package is used to read the VRT file and create a SpatRaster object. This object contains the sea ice concentration data, which can be visualized using the plot() function.\n\nr &lt;- rast(dsn)\n\nplot(r)",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Working with HE5 Files for Sea Ice Data</span>"
    ]
  },
  {
    "objectID": "vsicurl.html",
    "href": "vsicurl.html",
    "title": "5  GDAL Virtual File Systems",
    "section": "",
    "text": "5.1 Reading the data from a GeoTIFF file\nr &lt;- terra::rast(\n  \"/vsicurl/https://gebco2023.s3.valeria.science/gebco_2023_sub_ice_topo_cog.tif\"\n)\n\nr\n\nclass       : SpatRaster \ndimensions  : 43200, 86400, 1  (nrow, ncol, nlyr)\nresolution  : 0.004166667, 0.004166667  (x, y)\nextent      : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)\ncoord. ref. : lon/lat WGS 84 (EPSG:4326) \nsource      : gebco_2023_sub_ice_topo_cog.tif \nname        : gebco_2023_sub_ice_topo_cog \n\nplot(r)",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>GDAL Virtual File Systems</span>"
    ]
  },
  {
    "objectID": "vsicurl.html#reading-the-data-from-a-geotiff-file",
    "href": "vsicurl.html#reading-the-data-from-a-geotiff-file",
    "title": "5  GDAL Virtual File Systems",
    "section": "",
    "text": "vsicurl: https://gdal.org/drivers/raster/vsicurl.html is a GDAL virtual file system that allows reading files from a URL.",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>GDAL Virtual File Systems</span>"
    ]
  },
  {
    "objectID": "vsicurl.html#vsigzip",
    "href": "vsicurl.html#vsigzip",
    "title": "5  GDAL Virtual File Systems",
    "section": "5.2 vsigzip",
    "text": "5.2 vsigzip\n\nvsigzip: https://gdal.org/drivers/raster/vsigzip.html is a GDAL virtual file system that allows reading files from a gzip compressed file.\n\n\nsic &lt;- rast(\n  \"/vsigzip//vsicurl/ftp://ftp-projects.cen.uni-hamburg.de/seaice/AMSR2/3.125km/Arc_20201010_res3.125_pyres.nc.gz\",\n  \"sea_ice_concentration\"\n)\n\nsic\n\nclass       : SpatRaster \ndimensions  : 3584, 2432, 1  (nrow, ncol, nlyr)\nresolution  : 1, 1  (x, y)\nextent      : 0.5, 2432.5, 0.5, 3584.5  (xmin, xmax, ymin, ymax)\ncoord. ref. : +proj=longlat +datum=WGS84 +no_defs \nsource      : Arc_20201010_res3.125_pyres.nc.gz:sea_ice_concentration \nvarname     : sea_ice_concentration (daily averaged total ice concentration) \nname        : sea_ice_concentration \nunit        :                     % \ntime        : 2020-10-10 12:00:00 UTC \n\nplot(sic)\n\n\n\n\n\n\n\n\nFrom the documentation, we expect that data to be in polar stereographic projection with a specific extent. However, the data does not have the correct extent and projection. We can set the extent and projection manually:\n\n# Set the extent\next(sic) &lt;- ext(-3850000L, 3750000L, -5350000L, 5850000L)\n\n# Set the polar stereographic projection\ncrs(sic) &lt;- \"EPSG:3413\"\n\nsic\n\nclass       : SpatRaster \ndimensions  : 3584, 2432, 1  (nrow, ncol, nlyr)\nresolution  : 3125, 3125  (x, y)\nextent      : -3850000, 3750000, -5350000, 5850000  (xmin, xmax, ymin, ymax)\ncoord. ref. : WGS 84 / NSIDC Sea Ice Polar Stereographic North (EPSG:3413) \nsource      : Arc_20201010_res3.125_pyres.nc.gz:sea_ice_concentration \nvarname     : sea_ice_concentration (daily averaged total ice concentration) \nname        : sea_ice_concentration \nunit        :                     % \ntime        : 2020-10-10 12:00:00 UTC \n\n\nNow the data has the correct extent and projection. Each pixel represents the sea ice concentration in a 3.125 km x 3.125 km area.\n\nplot(sic)",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>GDAL Virtual File Systems</span>"
    ]
  },
  {
    "objectID": "filtering.html",
    "href": "filtering.html",
    "title": "6  Filtering spatial data",
    "section": "",
    "text": "6.1 Filtering spatial data with sf\nIn this tutorial, we will explore different methods to filter spatial data using the sf package in R. We will use the Canadian Wind Turbine Database as our example dataset.\nThe Canadian Wind Turbine Database contains the geographic location and key technology details for wind turbines installed in Canada.\nlibrary(sf)\nlibrary(DBI)\nlibrary(duckdb)\nlibrary(ggplot2)\n\n# URL to the wind turbine database\nurl &lt;- \"/vsizip//vsicurl/https://ftp.cartes.canada.ca/pub/nrcan_rncan/Wind-energy_Energie-eolienne/wind_turbines_database/wind_turbine_database_en.gdb.zip\"\n\n# List layers in the dataset\nst_layers(url)\n\n\n\n\n\n\n\n\n\n\n\n\n\nname\ngeomtype\ndriver\nfeatures\nfields\ncrs\n\n\n\n\nwind_turbine\nPoint\nOpenFileGDB\n7578\n17\nNAD83 / Canada Atlas Lambert , PROJCRS[“NAD83 / Canada Atlas Lambert”,\n\n\n\nBASEGEOGCRS[\"NAD83\",\n    DATUM[\"North American Datum 1983\",\n        ELLIPSOID[\"GRS 1980\",6378137,298.257222101,\n            LENGTHUNIT[\"metre\",1]]],\n    PRIMEM[\"Greenwich\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\n    ID[\"EPSG\",4269]],\nCONVERSION[\"Canada Atlas Lambert\",\n    METHOD[\"Lambert Conic Conformal (2SP)\",\n        ID[\"EPSG\",9802]],\n    PARAMETER[\"Latitude of false origin\",49,\n        ANGLEUNIT[\"degree\",0.0174532925199433],\n        ID[\"EPSG\",8821]],\n    PARAMETER[\"Longitude of false origin\",-95,\n        ANGLEUNIT[\"degree\",0.0174532925199433],\n        ID[\"EPSG\",8822]],\n    PARAMETER[\"Latitude of 1st standard parallel\",49,\n        ANGLEUNIT[\"degree\",0.0174532925199433],\n        ID[\"EPSG\",8823]],\n    PARAMETER[\"Latitude of 2nd standard parallel\",77,\n        ANGLEUNIT[\"degree\",0.0174532925199433],\n        ID[\"EPSG\",8824]],\n    PARAMETER[\"Easting at false origin\",0,\n        LENGTHUNIT[\"metre\",1],\n        ID[\"EPSG\",8826]],\n    PARAMETER[\"Northing at false origin\",0,\n        LENGTHUNIT[\"metre\",1],\n        ID[\"EPSG\",8827]]],\nCS[Cartesian,2],\n    AXIS[\"(E)\",east,\n        ORDER[1],\n        LENGTHUNIT[\"metre\",1]],\n    AXIS[\"(N)\",north,\n        ORDER[2],\n        LENGTHUNIT[\"metre\",1]],\nUSAGE[\n    SCOPE[\"Transformation of coordinates at 5m level of accuracy.\"],\n    AREA[\"Canada - onshore and offshore - Alberta; British Columbia; Manitoba; New Brunswick; Newfoundland and Labrador; Northwest Territories; Nova Scotia; Nunavut; Ontario; Prince Edward Island; Quebec; Saskatchewan; Yukon.\"],\n    BBOX[38.21,-141.01,86.46,-40.73]],\nID[\"EPSG\",3978]] |\n\n\n# Read the entire dataset\npts &lt;- read_sf(url)\n\n# Load and transform Canada map\ncanada &lt;- rnaturalearth::ne_countries(\n  scale = \"medium\",\n  returnclass = \"sf\",\n  country = \"Canada\"\n) |&gt;\n  st_transform(crs = \"EPSG:3978\")\n\n# Plot the map with wind turbine points\nggplot() +\n  geom_sf(data = canada) +\n  geom_sf(data = pts, color = \"red\", size = 0.5)",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Filtering spatial data</span>"
    ]
  },
  {
    "objectID": "filtering.html#filtering-spatial-data-with-a-bounding-box",
    "href": "filtering.html#filtering-spatial-data-with-a-bounding-box",
    "title": "6  Filtering spatial data",
    "section": "6.2 Filtering spatial data with a bounding box",
    "text": "6.2 Filtering spatial data with a bounding box\nTo avoid loading the entire dataset into memory, we can filter the data using a bounding box. This is particularly useful when working with large datasets. We can leverage the wkt_filter argument to filter spatial data and reduce the amount of data loaded into memory.\n\n# Read and transform the area of interest\narea &lt;- read_sf(fs::path(\"data\", \"area.geojson\")) |&gt;\n  st_transform(crs = st_crs(pts))\n\n# Plot the map with the area of interest\nggplot() +\n  geom_sf(data = canada) +\n  geom_sf(data = area, color = \"blue\", fill = NA, linewidth = 1L) +\n  geom_sf(data = pts, color = \"red\", size = 0.5)\n\n\n\n\n\n\n\n\nInstead of loading the entire dataset into memory, we can filter the data using a bounding box.\n\n# Convert the area geometry to WKT\nwkt &lt;- area |&gt;\n  st_geometry() |&gt;\n  st_as_text()\n\n# Read the filtered dataset using the bounding box\nfiltered &lt;- read_sf(url, wkt_filter = wkt)\nfiltered[[\"Notes\"]] &lt;- NULL\n\n\n# Plot the filtered data\nggplot() +\n  geom_sf(data = canada) +\n  geom_sf(data = area, color = \"blue\", fill = NA, linewidth = 1L) +\n  geom_sf(data = filtered, color = \"red\", size = 0.5)\n\n\n\n\n\n\n\n# Display the number of rows and the first few rows of the filtered data\nnrow(filtered)\n\n[1] 2032\n\nhead(filtered)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nProvince_Territory\nProject_Name\nTotal_Project_Capacity_MW\nTurbine_Identifier\nTurbine_Number\nTurbine_Number_in_Project\nTurbine_Rated_Capacity_kW\nRotor_Diameter_m\nHub_Height_m\nManufacturer\nModel\nCommissioning\nLatitude\nLongitude\nData_Sources\nBasemap\nShape\n\n\n\n\nNew Brunswick\nBurchill\n42\nBRH1\n1\n1/10\n4200\n141\n135\nEnercon\nE141-4.2\n2023\n45.15949\n-66.19081\n[70], [71], [910]\nESRI\nPOINT (2225020 82296.21)\n\n\nNew Brunswick\nBurchill\n42\nBRH2\n2\n2/10\n4200\n141\n135\nEnercon\nE141-4.2\n2023\n45.16434\n-66.19718\n[70], [71], [910]\nESRI\nPOINT (2224322 82566.09)\n\n\nNew Brunswick\nBurchill\n42\nBRH3\n3\n3/10\n4200\n141\n135\nEnercon\nE141-4.2\n2023\n45.16875\n-66.20070\n[70], [71], [910]\nESRI\nPOINT (2223851 82890.97)\n\n\nNew Brunswick\nBurchill\n42\nBRH4\n4\n4/10\n4200\n141\n135\nEnercon\nE141-4.2\n2023\n45.17307\n-66.20036\n[70], [71], [910]\nESRI\nPOINT (2223662 83342.02)\n\n\nNew Brunswick\nBurchill\n42\nBRH5\n5\n5/10\n4200\n141\n135\nEnercon\nE141-4.2\n2023\n45.17834\n-66.19340\n[70], [71], [910]\nESRI\nPOINT (2223902 84120.34)\n\n\nNew Brunswick\nBurchill\n42\nBRH6\n6\n6/10\n4200\n141\n135\nEnercon\nE141-4.2\n2023\n45.18281\n-66.18900\n[70], [71], [910]\nESRI\nPOINT (2223997 84728.45)",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Filtering spatial data</span>"
    ]
  },
  {
    "objectID": "filtering.html#refining-the-filter-with-a-user-defined-sql-query",
    "href": "filtering.html#refining-the-filter-with-a-user-defined-sql-query",
    "title": "6  Filtering spatial data",
    "section": "6.3 Refining the filter with a user-defined SQL query",
    "text": "6.3 Refining the filter with a user-defined SQL query\nWe can further refine our filter by using a user-defined query. For example, we can filter the wind turbines based on their rated capacity.\n\n# Display the range of turbine capacities\nrange(filtered[[\"Turbine_Rated_Capacity__kW_\"]])\n\n[1]    0 4200\n\n\nTo refine the filter, we can use a custom query to select only the wind turbines with a rated capacity greater than 4000 kW. First, we need to identify the layer name to use in the SQL query.\n\n# List layers in the dataset\nst_layers(url)\n\n\n\n\n\n\n\n\n\n\n\n\n\nname\ngeomtype\ndriver\nfeatures\nfields\ncrs\n\n\n\n\nwind_turbine\nPoint\nOpenFileGDB\n7578\n17\nNAD83 / Canada Atlas Lambert , PROJCRS[“NAD83 / Canada Atlas Lambert”,\n\n\n\nBASEGEOGCRS[\"NAD83\",\n    DATUM[\"North American Datum 1983\",\n        ELLIPSOID[\"GRS 1980\",6378137,298.257222101,\n            LENGTHUNIT[\"metre\",1]]],\n    PRIMEM[\"Greenwich\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\n    ID[\"EPSG\",4269]],\nCONVERSION[\"Canada Atlas Lambert\",\n    METHOD[\"Lambert Conic Conformal (2SP)\",\n        ID[\"EPSG\",9802]],\n    PARAMETER[\"Latitude of false origin\",49,\n        ANGLEUNIT[\"degree\",0.0174532925199433],\n        ID[\"EPSG\",8821]],\n    PARAMETER[\"Longitude of false origin\",-95,\n        ANGLEUNIT[\"degree\",0.0174532925199433],\n        ID[\"EPSG\",8822]],\n    PARAMETER[\"Latitude of 1st standard parallel\",49,\n        ANGLEUNIT[\"degree\",0.0174532925199433],\n        ID[\"EPSG\",8823]],\n    PARAMETER[\"Latitude of 2nd standard parallel\",77,\n        ANGLEUNIT[\"degree\",0.0174532925199433],\n        ID[\"EPSG\",8824]],\n    PARAMETER[\"Easting at false origin\",0,\n        LENGTHUNIT[\"metre\",1],\n        ID[\"EPSG\",8826]],\n    PARAMETER[\"Northing at false origin\",0,\n        LENGTHUNIT[\"metre\",1],\n        ID[\"EPSG\",8827]]],\nCS[Cartesian,2],\n    AXIS[\"(E)\",east,\n        ORDER[1],\n        LENGTHUNIT[\"metre\",1]],\n    AXIS[\"(N)\",north,\n        ORDER[2],\n        LENGTHUNIT[\"metre\",1]],\nUSAGE[\n    SCOPE[\"Transformation of coordinates at 5m level of accuracy.\"],\n    AREA[\"Canada - onshore and offshore - Alberta; British Columbia; Manitoba; New Brunswick; Newfoundland and Labrador; Northwest Territories; Nova Scotia; Nunavut; Ontario; Prince Edward Island; Quebec; Saskatchewan; Yukon.\"],\n    BBOX[38.21,-141.01,86.46,-40.73]],\nID[\"EPSG\",3978]] |\n\n\n\nWe can use wind_turbine as the layer name in the custom query.\n\n# Read the filtered dataset with a custom query\nhigh_capacity &lt;- read_sf(\n  url,\n  wkt_filter = wkt,\n  query = \"SELECT * FROM wind_turbine WHERE Turbine_Rated_Capacity__kW_ &gt; 4000\"\n)\n\nhigh_capacity[[\"Notes\"]] &lt;- NULL\n\n# Display the number of rows and the first few rows of the high capacity data\nnrow(high_capacity)\n\n[1] 10\n\n# Plot the high capacity turbines\nggplot() +\n  geom_sf(data = canada) +\n  geom_sf(data = area, color = \"blue\", fill = NA, linewidth = 1L) +\n  geom_sf(data = high_capacity, color = \"red\", size = 0.5)",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Filtering spatial data</span>"
    ]
  },
  {
    "objectID": "filtering.html#filtering-spatial-data-with-duckdb",
    "href": "filtering.html#filtering-spatial-data-with-duckdb",
    "title": "6  Filtering spatial data",
    "section": "6.4 Filtering spatial data with DuckDB",
    "text": "6.4 Filtering spatial data with DuckDB\nIn this section, we will demonstrate how to filter spatial data using DuckDB. DuckDB is an embedded analytical database that supports spatial extensions.\n\n# Connect to DuckDB\nconn &lt;- dbConnect(duckdb())\n\n# Install and load the spatial extension\ndbSendQuery(conn, \"INSTALL spatial;\")\ndbSendQuery(conn, \"LOAD spatial;\")\n\n# Create a table with spatial data filtered by a bounding box\ndbSendQuery(\n  conn,\n  \"\n  CREATE\n  OR REPLACE TABLE t AS\n  SELECT\n   *,\n   ST_asWKB(geom) AS geometry\n  FROM\n   ST_Read('/vsis3/spatial-playground/gmw_v3.fgb', spatial_filter_box = {'min_x' : - 30, 'min_y' : 0, 'max_x' : - 50, 'max_y' : 45});\n  \"\n)\n\n# Read the filtered data from DuckDB\nread_sf(conn, query = \"SELECT * FROM t\", geometry_column = \"geometry\")\n\n# Read the filtered data with an additional computed area column\nread_sf(\n  conn,\n  query = \"SELECT *, ST_Area(geom) as area1 FROM t\",\n  geometry_column = \"geometry\"\n) |&gt;\n  mutate(area2 = st_area(geometry), .after = area1)",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Filtering spatial data</span>"
    ]
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "Additional Resources",
    "section": "",
    "text": "Useful Links",
    "crumbs": [
      "Additional Resources"
    ]
  },
  {
    "objectID": "references.html#useful-links",
    "href": "references.html#useful-links",
    "title": "Additional Resources",
    "section": "",
    "text": "HDF EOS Tools and Information Center\nAMSR-E/AMSR2 Unified L3 Daily 12.5 km Brightness Temperatures, Sea Ice Concentration, Motion & Snow Depth Polar Grids, Version 1",
    "crumbs": [
      "Additional Resources"
    ]
  },
  {
    "objectID": "references.html#session-info",
    "href": "references.html#session-info",
    "title": "Additional Resources",
    "section": "Session Info",
    "text": "Session Info\n\n\nsessioninfo::session_info()\n\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.4.2 (2024-10-31)\n os       Linux Mint 22\n system   x86_64, linux-gnu\n ui       X11\n language en_CA:en\n collate  en_CA.UTF-8\n ctype    en_CA.UTF-8\n tz       America/Montreal\n date     2025-02-10\n pandoc   3.1.3 @ /usr/bin/ (via rmarkdown)\n quarto   1.6.39 @ /usr/local/bin/quarto\n\n─ Packages ───────────────────────────────────────────────────────────────────\n package     * version date (UTC) lib source\n cli           3.6.3   2024-06-21 [1] RSPM (R 4.4.0)\n digest        0.6.37  2024-08-19 [1] CRAN (R 4.4.1)\n evaluate      1.0.3   2025-01-10 [1] RSPM (R 4.4.0)\n fastmap       1.2.0   2024-05-15 [1] CRAN (R 4.4.0)\n htmltools     0.5.8.1 2024-04-04 [1] RSPM\n htmlwidgets   1.6.4   2023-12-06 [1] RSPM\n jsonlite      1.8.9   2024-09-20 [1] RSPM (R 4.4.0)\n knitr         1.49    2024-11-08 [1] RSPM (R 4.4.0)\n rlang         1.1.5   2025-01-17 [1] RSPM (R 4.4.0)\n rmarkdown     2.29    2024-11-04 [1] CRAN (R 4.4.2)\n sessioninfo   1.2.3   2025-02-05 [1] RSPM (R 4.4.0)\n xfun          0.50    2025-01-07 [1] CRAN (R 4.4.2)\n\n [1] /home/filoche/R/x86_64-pc-linux-gnu-library/4.4\n [2] /usr/local/lib/R/site-library\n [3] /usr/lib/R/site-library\n [4] /usr/lib/R/library\n\n──────────────────────────────────────────────────────────────────────────────",
    "crumbs": [
      "Additional Resources"
    ]
  }
]