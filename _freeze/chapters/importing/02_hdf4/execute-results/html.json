{
  "hash": "226e77da28e967575e95d07d486b220f",
  "result": {
    "engine": "knitr",
    "markdown": "# HDF4 format\n\n\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(terra)\n```\n:::\n\n\n\n\n\n## NetCDF (Network Common Data Form)\n\nLayers in the file can be listed using the `nc_open()` function:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfile <- here::here(\"data\", \"avhrr-only-v2.20160503.nc\")\n```\n:::\n\n\n\n\n\n### Open NetCDF file using `rast()`\n\nThe `terra` package provides an alternative method to work with NetCDF files. This creates a `SpatRaster` object, which is more memory-efficient for large datasets.\n\nTo see which layers are available in the file, use the `describe()` function. Note the `var` column in the output:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndescribe(file, sds = TRUE)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| id|name                                                                                                      |var  |desc                                 | nrow| ncol| nlyr|\n|--:|:---------------------------------------------------------------------------------------------------------|:----|:------------------------------------|----:|----:|----:|\n|  1|NETCDF:\"/media/LaCie16TB/work/projects/documentation/read_rs_product/data/avhrr-only-v2.20160503.nc\":sst  |sst  |[1x1x720x1440] sst (16-bit integer)  |  720| 1440|    1|\n|  2|NETCDF:\"/media/LaCie16TB/work/projects/documentation/read_rs_product/data/avhrr-only-v2.20160503.nc\":anom |anom |[1x1x720x1440] anom (16-bit integer) |  720| 1440|    1|\n|  3|NETCDF:\"/media/LaCie16TB/work/projects/documentation/read_rs_product/data/avhrr-only-v2.20160503.nc\":err  |err  |[1x1x720x1440] err (16-bit integer)  |  720| 1440|    1|\n|  4|NETCDF:\"/media/LaCie16TB/work/projects/documentation/read_rs_product/data/avhrr-only-v2.20160503.nc\":ice  |ice  |[1x1x720x1440] ice (16-bit integer)  |  720| 1440|    1|\n\n</div>\n:::\n:::\n\n\n\n\n\nThis file contains four layers: `sst`, `anom`, `err`, and `ice`. They can be opened using the `rast()` function using the `lyrs` or `subds` argument.\n\n::: {.callout-note}\nTODO: Explain the difference between `lyrs` and `subds`.\n:::\n\n#### Open a specific layer using `lyrs`\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# To open the sst layer\nsst_layer <- rast(paste0(\"NETCDF:\", file, \":sst\"))\n\n# To open the anom layer\nanom_layer <- rast(paste0(\"NETCDF:\", file, \":anom\"))\n\n# To open the err layer\nerr_layer <- rast(paste0(\"NETCDF:\", file, \":err\"))\n\n# To open the ice layer\nice_layer <- rast(paste0(\"NETCDF:\", file, \":ice\"))\n```\n:::\n\n\n\n\n\n#### Open a specific layer using `subds`\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# To open the sst layer\nsst_layer <- rast(file, subds = \"sst\")\n\n# To open the anom layer\nanom_layer <- rast(file, subds = \"anom\")\n\n# To open the err layer\nerr_layer <- rast(file, subds = \"err\")\n\n# Open the ice layer\nice_layer <- rast(file, subds = \"ice\")\n```\n:::\n\n\n\n\n\n### Plotting\n\nWe can visualize the layers using the `plot()` function:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow = c(2L, 2L))\nplot(sst_layer, main = \"SST\")\nplot(anom_layer, main = \"Anomaly\")\nplot(err_layer, main = \"Error\")\nplot(ice_layer, main = \"Ice\")\n```\n\n::: {.cell-output-display}\n![](02_hdf4_files/figure-html/unnamed-chunk-7-1.png)\n:::\n:::\n\n\n\n\n\nIt looks like the raster is rotated. We can rotate it back with the `rotate()` function:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsst_layer <- rotate(sst_layer)\n\nplot(sst_layer)\n```\n\n::: {.cell-output-display}\n![](02_hdf4_files/figure-html/unnamed-chunk-8-1.png)\n:::\n:::\n\n\n\n\n\nConverting to a data frame can be useful for certain types of analysis or visualization, but be cautious with large datasets as this can be memory-intensive.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- as.data.frame(sst_layer)\n\nhead(df)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| sst_zlev=0|\n|----------:|\n|       -1.7|\n|       -1.7|\n|       -1.7|\n|       -1.7|\n|       -1.7|\n|       -1.7|\n\n</div>\n:::\n:::\n",
    "supporting": [
      "02_hdf4_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}